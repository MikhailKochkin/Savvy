# Migration `20221129115302-my_teams`

This migration has been generated by MikhailKochkin at 11/29/2022, 3:53:02 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "User" DROP CONSTRAINT "User_teamId_fkey"

ALTER TABLE "Team" ADD COLUMN     "founderId" TEXT NOT NULL

ALTER TABLE "User" DROP COLUMN "teamId"

CREATE TABLE "_joinedTeams" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL
)

CREATE UNIQUE INDEX "_joinedTeams_AB_unique" ON "_joinedTeams"("A", "B")

CREATE INDEX "_joinedTeams_B_index" ON "_joinedTeams"("B")

ALTER TABLE "_joinedTeams" ADD FOREIGN KEY("A")REFERENCES "Team"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_joinedTeams" ADD FOREIGN KEY("B")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Team" ADD FOREIGN KEY("founderId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20221129113513-..20221129115302-my_teams
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Application {
   id            String     @id @default(cuid())
@@ -753,10 +753,12 @@
 model Team {
   id                  String               @id @default(cuid())
   name                String
   image               String?
+  founderId           String
+  founder             User     @relation(fields: [founderId], references: [id])
   orders              Order[]
-  users               User[]
+  users               User[]              @relation("joinedTeams")
   updatedAt     DateTime   @updatedAt
   createdAt     DateTime   @default(now())
 }
@@ -789,10 +791,8 @@
   tags                String[]
   permissions         Permission[]
   uniId               String?
   companyId           String?
-  teamId              String?
-  team                Team?                @relation(fields: [teamId], references: [id])
   legalPortfolioId    String?              @unique
   careerTrackId       String?              @unique
   levelId             String?              @unique
   careerTrack         CareerTrack?         @relation(fields: [careerTrackId], references: [id])
@@ -841,8 +841,10 @@
   testResults         TestResult[]
   textEditors         TextEditor[]
   textEditorResults   TextEditorResult[]
   lawrdles            Lawrdle[]
+  teams               Team[]              
+  myTeams             Team[]              @relation("joinedTeams")
   teamQuests          TeamQuest[]
   teamQuestResults    TeamQuestResult[]
   co_coursePages      CoursePage[]         @relation("AuthorsCoursePage")
   new_subjects        CoursePage[]         @relation("UserSubjects")
```


