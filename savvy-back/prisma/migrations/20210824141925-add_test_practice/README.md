# Migration `20210824141925-add_test_practice`

This migration has been generated by MikhailKochkin at 8/24/2021, 5:19:25 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "TestPractice" (
    "id" TEXT NOT NULL,
    "text" TEXT NOT NULL,
    "tasksNum" INTEGER NOT NULL,
    "tasks" TEXT[],
    "userId" TEXT,
    "lessonId" TEXT,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY ("id")
)

CREATE TABLE "TestPracticeResult" (
    "id" TEXT NOT NULL,
    "tasks" TEXT[],
    "correct" INTEGER NOT NULL,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "studentId" TEXT NOT NULL,
    "lessonId" TEXT,
    "testPracticeId" TEXT,

    PRIMARY KEY ("id")
)

ALTER TABLE "TestPractice" ADD FOREIGN KEY("lessonId")REFERENCES "Lesson"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "TestPractice" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "TestPracticeResult" ADD FOREIGN KEY("lessonId")REFERENCES "Lesson"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "TestPracticeResult" ADD FOREIGN KEY("studentId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "TestPracticeResult" ADD FOREIGN KEY("testPracticeId")REFERENCES "TestPractice"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210714144423..20210824141925-add_test_practice
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Application {
   id            String     @id @default(cuid())
@@ -300,8 +300,10 @@
   examResult          ExamResult[]
   lessonFeedback      Feedback[]
   lessonResults       LessonResult[]
   newTests            NewTest[]
+  testPractices       TestPractice[]
+  testPracticeResults TestPracticeResult[]
   notes               Note[]
   problems            Problem[]
   problemResults      ProblemResult[]
   quizes              Quiz[]
@@ -346,8 +348,37 @@
   user        User         @relation(fields: [userId], references: [id])
   testResults TestResult[]
 }
+model TestPractice {
+  id         String   @id @default(cuid())
+  text       String
+  tasksNum   Int
+  tasks      String[]
+  userId     String?
+  lessonId   String?
+  lesson     Lesson?  @relation(fields: [lessonId], references: [id])
+  user       User?    @relation(fields: [userId], references: [id])
+  testPracticeResults TestPracticeResult[]
+  updatedAt DateTime @updatedAt
+  createdAt DateTime @default(now())
+}
+
+model TestPracticeResult {
+  id         String   @id @default(cuid())
+  tasks      String[]
+  correct   Int
+  updatedAt DateTime @updatedAt
+  createdAt DateTime @default(now())
+  studentId String
+  lessonId  String?
+  testPracticeId    String?
+  lesson    Lesson?  @relation(fields: [lessonId], references: [id])
+  student   User     @relation(fields: [studentId], references: [id])
+  testPractice      TestPractice? @relation(fields: [testPracticeId], references: [id])
+
+}
+
 model Note {
   id         String   @id @default(cuid())
   text       String
   lessonID   String?  @default(cuid())
@@ -642,8 +673,10 @@
   shots               Shot[]
   shotResults         ShotResult[]
   statements          Statement[]
   tests               Test[]
+  testPractices       TestPractice[]
+  testPracticeResults TestPracticeResult[]
   testResults         TestResult[]
   textEditors         TextEditor[]
   textEditorResults   TextEditorResult[]
   co_coursePages      CoursePage[]         @relation("AuthorsCoursePage")
```


