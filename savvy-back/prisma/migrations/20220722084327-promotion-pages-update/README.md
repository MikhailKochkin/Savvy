# Migration `20220722084327-promotion-pages-update`

This migration has been generated by MikhailKochkin at 7/22/2022, 12:43:27 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "_PostCoursePages" DROP CONSTRAINT "_PostCoursePages_A_fkey"

ALTER TABLE "_PostCoursePages" DROP CONSTRAINT "_PostCoursePages_B_fkey"

ALTER TABLE "Lawrdle" ADD COLUMN     "pros" TEXT[],
ADD COLUMN     "tags" TEXT[],
ADD COLUMN     "coursePageId" TEXT

ALTER TABLE "Post" ADD COLUMN     "coursePageId" TEXT,
ALTER COLUMN "language" SET DEFAULT E'ru'

CREATE TABLE "Useful" (
    "id" TEXT NOT NULL,
    "header" TEXT NOT NULL,
    "buttonText" TEXT NOT NULL,
    "link" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "tags" TEXT[],

    PRIMARY KEY ("id")
)

DROP TABLE "_PostCoursePages"

ALTER TABLE "Lawrdle" ADD FOREIGN KEY("coursePageId")REFERENCES "CoursePage"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Post" ADD FOREIGN KEY("coursePageId")REFERENCES "CoursePage"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20220721112556-..20220722084327-promotion-pages-update
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Application {
   id            String     @id @default(cuid())
@@ -201,9 +201,10 @@
   PointATest        PointATest[]
   authors           User[]            @relation("AuthorsCoursePage")
   careerTrackUnit   CareerTrackUnit[]
   careerTrack       CareerTrack[]     @relation("CoursePageForCareer")
-  posts             Post[]            @relation("PostCoursePages")
+  posts             Post[]            
+  lawrdles          Lawrdle[]         
   new_students      User[]            @relation("UserSubjects")
   certificates      Certificate[]
 }
@@ -465,18 +466,19 @@
 model Post {
   id          String       @id @default(cuid())
   title       String?
   text        String?
-  language    String?      @default("en")
+  language    String?      @default("ru")
   summary     String?
   image       String?
   createdAt   DateTime     @default(now())
   updatedAt   DateTime     @updatedAt
   likes       Int?         @default(1)
   tags        String[]
   userId      String
+  coursePageId String?
   user        User         @relation(fields: [userId], references: [id])
-  coursePages CoursePage[] @relation("PostCoursePages")
+  coursePages CoursePage?   @relation(fields: [coursePageId], references: [id])
 }
 model Problem {
   id             String          @id @default(cuid())
@@ -921,13 +923,27 @@
   word        String
   story       String
   authorId    String
   active      Boolean
+  pros        String[]
+  tags        String[]
   author      User     @relation(fields: [authorId], references: [id])
-  createdAt      DateTime @default(now())
-  updatedAt      DateTime @updatedAt
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+  coursePageId  String?
+  coursePage  CoursePage?  @relation(fields: [coursePageId], references: [id])
 }
+model Useful {
+  id          String   @id @default(cuid())
+  header      String
+  buttonText  String
+  link        String
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+  tags        String[]
+}
+
 enum CheckType {
   WORD
   IDEA
 }
```


