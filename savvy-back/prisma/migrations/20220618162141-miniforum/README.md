# Migration `20220618162141-miniforum`

This migration has been generated by MikhailKochkin at 6/18/2022, 8:21:41 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "Lesson" ADD COLUMN     "miniforumId" TEXT

ALTER TABLE "Statement" ADD COLUMN     "miniforumId" TEXT

CREATE TABLE "MiniForum" (
    "id" TEXT NOT NULL,
    "text" TEXT,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "lessonId" TEXT,
    "userId" TEXT,
    "type" TEXT,
    "value" TEXT,

    PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Lesson_miniforumId_unique" ON "Lesson"("miniforumId")

ALTER TABLE "MiniForum" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Lesson" ADD FOREIGN KEY("miniforumId")REFERENCES "MiniForum"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Statement" ADD FOREIGN KEY("miniforumId")REFERENCES "MiniForum"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20220616185417-remoce-cuid..20220618162141-miniforum
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Application {
   id            String     @id @default(cuid())
@@ -282,8 +282,22 @@
   rating     Rating[]
   statements Statement[]
 }
+model MiniForum {
+  id         String      @id @default(cuid())
+  text       String?
+  createdAt  DateTime    @default(now())
+  updatedAt  DateTime    @updatedAt
+  lessonId   String?
+  userId     String?
+  user       User?       @relation(fields: [userId], references: [id])
+  lesson     Lesson?
+  statements Statement[]
+  type       String?
+  value      String?
+}
+
 model LegalPortfolio {
   id           String       @id @default(cuid())
   cv           String?
   resume       String?
@@ -316,12 +330,14 @@
   assignment          Boolean?
   map                 Json[]
   userId              String
   coursePageId        String
+  miniforumId         String?
   forumId             String?              @unique
   image               String?
   coursePage          CoursePage           @relation(fields: [coursePageId], references: [id])
   forum               Forum?               @relation(fields: [forumId], references: [id])
+  miniforums          MiniForum?           @relation(fields: [miniforumId], references: [id])
   user                User                 @relation(fields: [userId], references: [id])
   challengeResults    ChallengeResult[]
   chats               Chat[]
   constructions       Construction[]
@@ -583,11 +599,13 @@
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
   userId    String?
   forumId   String?
+  miniforumId String?
   comments  String[]
   answered  Boolean? @default(false)
   forum     Forum?   @relation(fields: [forumId], references: [id])
+  miniforum MiniForum?   @relation(fields: [miniforumId], references: [id])
   user      User?    @relation(fields: [userId], references: [id])
 }
 model TestResult {
@@ -698,8 +716,9 @@
   certificates        Certificate[]
   studentFeedback     Feedback[]           @relation("StudentFeedback")
   teacherFeedback     Feedback[]           @relation("TeacherFeedback")
   forums              Forum[]
+  miniforums          MiniForum[]
   lessons             Lesson[]
   lessonResults       LessonResult[]
   newTests            NewTest[]
   notes               Note[]
```


