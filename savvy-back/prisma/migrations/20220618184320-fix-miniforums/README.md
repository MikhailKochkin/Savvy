# Migration `20220618184320-fix-miniforums`

This migration has been generated by MikhailKochkin at 6/18/2022, 10:43:20 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "Lesson_miniforumId_unique"

ALTER TABLE "Lesson" DROP CONSTRAINT "Lesson_miniforumId_fkey"

ALTER TABLE "Lesson" DROP COLUMN "miniforumId"

ALTER TABLE "MiniForum" ADD FOREIGN KEY("lessonId")REFERENCES "Lesson"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20220618162141-miniforum..20220618184320-fix-miniforums
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Application {
   id            String     @id @default(cuid())
@@ -290,9 +290,9 @@
   updatedAt  DateTime    @updatedAt
   lessonId   String?
   userId     String?
   user       User?       @relation(fields: [userId], references: [id])
-  lesson     Lesson?
+  lesson     Lesson?      @relation(fields: [lessonId], references: [id])
   statements Statement[]
   type       String?
   value      String?
 }
@@ -330,14 +330,13 @@
   assignment          Boolean?
   map                 Json[]
   userId              String
   coursePageId        String
-  miniforumId         String?
   forumId             String?              @unique
   image               String?
   coursePage          CoursePage           @relation(fields: [coursePageId], references: [id])
   forum               Forum?               @relation(fields: [forumId], references: [id])
-  miniforums          MiniForum?           @relation(fields: [miniforumId], references: [id])
+  miniforums          MiniForum[]          
   user                User                 @relation(fields: [userId], references: [id])
   challengeResults    ChallengeResult[]
   chats               Chat[]
   constructions       Construction[]
```


