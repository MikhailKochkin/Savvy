# Migration `20221013132923-programs`

This migration has been generated by MikhailKochkin at 10/13/2022, 5:29:23 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "Order" ADD COLUMN     "programId" TEXT

ALTER TABLE "User" ADD COLUMN     "country" TEXT

CREATE TABLE "Program" (
    "id" TEXT NOT NULL,
    "title" TEXT NOT NULL,
    "description" TEXT NOT NULL,
    "image" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "price" INTEGER,
    "currency" TEXT DEFAULT E'ruble',
    "discountPrice" INTEGER,
    "published" BOOLEAN DEFAULT false,
    "news" TEXT,
    "audience" TEXT,
    "result" TEXT,
    "tariffs" TEXT,
    "methods" TEXT,
    "video" TEXT,
    "batch" TEXT,
    "header" TEXT[],
    "subheader" TEXT[],
    "nextStart" TIMESTAMP(3),
    "uptodateAt" TIMESTAMP(3),
    "goals" TEXT[],
    "reviews" JSONB,
    "installments" INTEGER,
    "tags" TEXT[],
    "promocode" JSONB,

    PRIMARY KEY ("id")
)

CREATE TABLE "_CoursePageToProgram" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL
)

CREATE UNIQUE INDEX "_CoursePageToProgram_AB_unique" ON "_CoursePageToProgram"("A", "B")

CREATE INDEX "_CoursePageToProgram_B_index" ON "_CoursePageToProgram"("B")

ALTER TABLE "_CoursePageToProgram" ADD FOREIGN KEY("A")REFERENCES "CoursePage"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_CoursePageToProgram" ADD FOREIGN KEY("B")REFERENCES "Program"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Order" ADD FOREIGN KEY("programId")REFERENCES "Program"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20220909092402-..20221013132923-programs
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Application {
   id            String     @id @default(cuid())
@@ -215,10 +215,42 @@
   lawrdles          Lawrdle[]         
   new_students      User[]            @relation("UserSubjects")
   certificates      Certificate[]
   businessClients   BusinessClient[]
+  programs          Program[]
 }
+model Program {
+  id                String            @id @default(cuid())
+  title             String
+  description       String
+  image             String
+  createdAt         DateTime          @default(now())
+  updatedAt         DateTime          @updatedAt
+  price             Int?
+  currency          String?           @default("ruble")
+  discountPrice     Int?
+  published         Boolean?          @default(false)
+  news              String?           
+  audience          String?
+  result            String?
+  tariffs           String?
+  methods           String?
+  video             String?
+  batch             String?
+  header            String[]
+  subheader         String[]
+  nextStart         DateTime?
+  uptodateAt        DateTime?
+  goals             String[]
+  reviews           Json?
+  installments      Int?
+  tags              String[]
+  promocode         Json?
+  orders            Order[]
+  coursePages       CoursePage[]
+}
+
 model CourseVisit {
   id           String     @id @default(cuid())
   visitsNumber Int?       @default(0)
   comment      String?
@@ -468,8 +500,10 @@
   level        Level?
   comment      String?
   userId       String
   coursePageId String
+  programId    String?
+  program      Program?  @relation(fields: [programId], references: [id])
   coursePage   CoursePage @relation(fields: [coursePageId], references: [id])
   user         User       @relation(fields: [userId], references: [id])
 }
@@ -687,8 +721,9 @@
   name                String
   number              String?
   email               String               @unique
   password            String
+  country             String?
   resetToken          String?
   resetTokenExpiry    Float?
   isFamiliar          Boolean              @default(false)
   createdAt           DateTime             @default(now())
```


